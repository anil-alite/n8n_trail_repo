name: Code Analysis Main Branch Update

on:
  push:
    branches:
      - main

jobs:
  trigger-update:
    runs-on: ubuntu-latest
    steps:
      - name: Trigger Main Update API
        env:
          API_BASE_URL: ${{ secrets.API_BASE_URL }}
        run: |
          curl -f -X POST "$API_BASE_URL/api/main-update" \
          -H "Content-Type: application/json" \
          --retry 3 \
          --retry-delay 5 \
          -d "{
            \"repo_name\": \"${{ github.repository }}\",
            \"repo_url\": \"https://github.com/${{ github.repository }}.git\",
            \"branch\": \"main\",
            \"email_list\": [\"admin@example.com\"]
          }"
